<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="<{$css_url}>client/webview/css/normalize.css" rel="stylesheet">
    <link rel="stylesheet" href="<{$css_url}>client/webview/css/bus_detail.css">
    <title>商家详情</title>
</head>
<body>
<header>
    <div class="header-left">
        <div class="head-img"><img src="<{$file_url}><{$data['shop']['data']['logo_s']}>" width="100%" height="100%">
        </div>
        <div class="aut-show">
            <ul>
                <{if($data['shop']['data']['type'] == 11)}>
                <{if($data['shop']['data']['id_card_ceritfication'] == 1)}>
                <li>
                        <span>
                            <i class="icon-identity"></i>
                        </span>
                    法人认证
                </li>
                <{/if}>
                <{if($data['shop']['data']['tax'] == 1)}>
                <li>
                        <span>
                            <i class="icon-tax"></i>
                        </span>
                    税务认证
                </li>
                <{/if}>
                <{if($data['shop']['data']['license'] == 1)}>
                <li>
                        <span>
                            <i class="icon-license"></i>
                        </span>
                    营业执照
                </li>
                <{/if}>
                <{else}>
                <{if($data['shop']['data']['id_card_ceritfication'] == 1)}>
                <li>
                        <span>
                            <i class="icon-identity"></i>
                        </span>
                    身份认证
                </li>
                <{/if}>
                <{if($data['shop']['data']['education'] == 1)}>
                <li>
                        <span>
                            <i class="icon-education"></i>
                        </span>
                    学历认证
                </li>
                <{/if}>
                <{if($data['shop']['data']['qualification'] == 1)}>
                <li>
                        <span>
                            <i class="icon-qualifications"></i>
                        </span>
                    资质认证
                </li>
                <{/if}>
                <{/if}>
            </ul>
        </div>
    </div>
    <div class="header-right">
        <p class="shop-title"><{$data['shop']['data']['real_name']}></p>

        <p><{$data['shop']['data']['shop_date']}>年<{if($data['shop']['data']['type'] == 11)}>成立<{else}>译龄<{/if}>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>

        <p class="address-box"><i class="icon-address"></i> &nbsp;&nbsp;&nbsp;&nbsp;<{$data['shop']['data']['city']}>
        </p>

        <p class="separate"><span>服务语言：<{foreach($data['shop']['data']['good_at_name'] as $k => $v)}><{$v}>&nbsp;<{/foreach}></span></p>

        <p><span>适用领域：<{foreach($data['shop']['data']['field_name'] as $k => $v)}><{$v}>&nbsp;<{/foreach}></span></p>
        <ul>
            <{foreach($data['shop']['data']['label_word_ids_name'] as $k => $v)}>
            <li><{$v}></li>
            <{/foreach}>
        </ul>
        <div><a href="javascript:void(0);" class="js-more">更多</a></div>
        <div class="head-sever">
            服务<{$data['shop']['data']['service_times']}>次&nbsp;&nbsp;&nbsp;
            好评<{$data['shop']['data']['star_num']}>分
            <{if($data['shop']['data']['star_num'] == 0)}>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] > 0 && $data['shop']['data']['star_num'] < 1)}>
            <span><i class="half-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] == 1)}>
            <span><i class="full-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] > 1 && $data['shop']['data']['star_num'] < 2)}>
            <span><i class="full-start"></i></span>
            <span><i class="half-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] == 2)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] > 2 && $data['shop']['data']['star_num'] < 3)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="half-start"></i></span>
            <span><i class="empty-start"></i></span>
           <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] == 3)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="empty-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] > 3 && $data['shop']['data']['star_num'] < 4)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="half-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] == 4)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="empty-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] > 4 && $data['shop']['data']['star_num'] < 5)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="half-start"></i></span>
            <{elseif($data['shop']['data']['star_num'] == 5)}>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <span><i class="full-start"></i></span>
            <{else}>
            <{/if}>
        </div>
    </div>
</header>
<nav id="js-nav">
    <a href="javascript:void(0);" class="selected-state js-btn" data-nav="service">全部服务</a>
    <a href="javascript:void(0);" class="js-btn js-detil" data-nav="detail">服务详情</a>
    <a href="javascript:void(0);" class="js-btn" data-nav="eval">店铺评价</a>
</nav>
<section>
    <div class="product-list" id="related_pro">
        <ul>
            <{if($data['products'][1] > 0)}>
            <{foreach($data['products'][0] as $k => $v)}>
            <li>
                <div class="list-left">
                    <div class="list-img"><a href="javascript:void(0);" data-id="<{$v['id']}>"
                                             class="href-block js-buy"><img
                            src="<{$file_url}><{$v['logo_s']}>" width="100%"
                            height="auto"> </a></div>
                    <div class="pro-price"><span>￥<{$v['price']}></span>元/<{$v['price_type_text']}></div>

                </div>
                <div class="list-right">
                    <a href="javascript:void(0);" data-id="<{$v['id']}>" class="href-block js-buy">
                        <h3><{$v['title']}> <span>&nbsp;<i class="icon-address"></i>&nbsp;&nbsp;&nbsp;<{$v['city']}></span></h3>

                        <p><{$v['type_name']}>&nbsp;&nbsp;&nbsp;&nbsp;
                            <{$v['language']}><{if($v['type'] == 1)}>-><{else}><-><{/if}><{$v['to_language']}></p>

                        <p class="separate">
                            适用领域：<{if(empty($v['field_name']))}>未添加<{else}><{$v['field_name']}><{/if}></p>

                        <p><{if($v['type'] ==
                            1)}>文件类型<{else}>服务类型<{/if}>：<{if(empty($v['category_name']))}>未添加<{else}><{$v['category_name']}><{/if}></p>
                        <ul class="shop-label">
                            <{foreach($v['service_commitment_name'] as $kk => $vv)}>
                            <li><{$vv}></li>
                            <{/foreach}>
                        </ul>
                        <{if($v['shop_is_recommend'] == 1)}>
                        <div class="label-remd"></div>
                        <{/if}>
                    </a>

                    <!--<div class="buy-btn"><a href="javascript:void(0);" class="js-buy"
                                            data-id="<{$v['id']}>">立即购买</a></div>-->
                </div>
            </li>
            <{/foreach}>
            <{else}>
            <li class="text-center">商家暂未添加商品！</li>
            <{/if}>
        </ul>
    </div>
    <div style="display: none" class="service-detail">
        <h3><{if($data['shop']['data']['type'] == 11)}>[公司简介]<{else}>[译者简介]<{/if}></h3>

        <p><{echo htmlspecialchars_decode($data['shop']['data']['detail']);}></p>

        <h3>[服务语言]</h3>

        <p><{foreach($data['shop']['data']['good_at_name'] as $k => $v)}><{$v}>&nbsp;<{/foreach}></p>

        <h3>[适用领域]</h3>

        <p><{foreach($data['shop']['data']['field_name'] as $k => $v)}><{$v}>&nbsp;<{/foreach}></p>

        <h3>[服务承诺]</h3>
        <ul class="service-label" id="service_label">
            <{foreach($data['shop']['data']['label_word_ids_name'] as $k => $v)}>
            <li><{$v}></li>
            <{/foreach}>
        </ul>
        <h3>[成果展示]</h3>

        <div class="result-show">
            <{if($data['experiences'][1] > 0)}>
            <ul>
                <{foreach($data['experiences'][0] as $k => $v)}>
                <li>
                    <div class="result-text">
                        <{if($v['type'] == 2 || $v['type'] == 5)}>
                        <i class="icon-result1"></i>
                        <{elseif($v['type'] == 6)}>
                        <i class="icon-result2"></i>
                        <{elseif($v['type'] == 1 || $v['type'] == 4)}>
                        <i class="icon-result3"></i>
                        <{/if}>
                        <i class="icon-triangle"></i>

                        <div class="result-title">
                            <span class="pull-left"><{$v['start_time']}>-<{$v['end_time']}></span>
                            <span class="pull-right"><{$v['type_text']}></span>
                        </div>
                        <p><{$v['content']}></p>
                    </div>
                </li>
                <{/foreach}>
            </ul>
            <{else}>
            <p class="text-center">商家暂未添加成果！</p>
            <{/if}>
        </div>
    </div>
    <div style="display: none" class="service-evaluate">
        <ul id="eval_list">
        </ul>
        <p id="get_more"
           style="line-height: 2.5rem;text-align: center;background-color: #FAFAFA;color: #666;font-size: 0.75rem;"
           class="js-more-eval">点击加载更多</p>
    </div>
</section>
<script type="text/javascript" src="<{$css_url}>client/webview/js/zepto.min.js"></script>
<script type="text/javascript">
    $(function () {
        //容错机制，向下兼容,並且兼容ios端
        if (window.JsInteraction && window.JsInteraction.loadMerchantInfo) {
            var lis = document.getElementById('service_label').getElementsByTagName('li'),
                    lis_len = lis.length,
                    service_label_str = [];
            for (var i = 0; i < lis_len; i++) {
                service_label_str.push(lis[i].innerHTML);
            }
            JsInteraction.loadMerchantInfo(JSON.stringify({
                id: '<{$data["shop"]["data"]["id"]}>',
                name: '<{$data["shop"]["data"]["title"]}>',
                year: '<{$data["shop"]["data"]["shop_date"]}>',
                phone: '<{$data["shop"]["data"]["user_phone"]}>',
                type: '<{$data["shop"]["data"]["type_name"]}>',
                look: '<{$data["shop"]["data"]["logo_s"]}>',
                im: '<{$data["shop"]["data"]["uid"]}>',
                shopAddr: '<{$data["shop"]["data"]["city"]}>',
                shopType: '<{$data["shop"]["data"]["type"]}>',
                strTags: service_label_str.join(' ')
            }));
        }

        var init_flag = 1;
        $('#related_pro').on('tap', '.js-contact', function () {
            var obj = {
                id: $(this).attr('data-id'),
                name: $(this).attr('data-uname'),
                year: $(this).attr('data-year'),
                phone: $(this).attr('data-phone'),
                type: $(this).attr('data-utype'),
                look: $(this).attr('data-look'),
                im: $(this).attr('data-im'),
                shopType: $(this).attr('data-stype')
            }
            JsInteraction.contactMerchant(JSON.stringify(obj));
        });
        $('#related_pro').on('click', '.js-buy', function () {
            JsInteraction.buyProduct($(this).attr('data-id'));
        });
        var $nav = $('#js-nav');
        //点击事件
        $nav.on('tap', '.js-btn', function () {
            var $this = $(this),
                    type = $this.attr('data-nav');
            if (type == 'detail') {
                $nav.find('.selected-state').removeClass('selected-state');
                $this.addClass('selected-state');
                $('.product-list').hide();
                $('.service-detail').show();
                $('.service-evaluate').hide();
            } else if (type == 'eval') {
                $nav.find('.selected-state').removeClass('selected-state');
                $this.addClass('selected-state');
                $('.product-list').hide();
                $('.service-detail').hide();
                $('.service-evaluate').show();
                initEval();
            } else {
                $nav.find('.selected-state').removeClass('selected-state');
                $($this).addClass('selected-state');
                $('.product-list').show();
                $('.service-detail').hide();
                $('.service-evaluate').hide();
            }
        });
        //更多按钮
        $('.js-more').on('tap', function () {
            $nav.find('.selected-state').removeClass('selected-state');
            $nav.find('.js-detil').addClass('selected-state');
            $('.product-list').hide();
            $('.service-detail').show();
            $('.service-evaluate').hide();
        });

        var initEval = function () {
            var eval = {
                offset: 0,
                'shop_id': '<{$data["shop"]["data"]["id"]}>',
                init: function () {
                    var that = this;
                    init_flag && that.requestEval(function (data) {
                        if (data.status == 0) {
                            that.setParams(data.data['request_param']);
                            var html = that.createHtml(data.data['list']);
                            that.appendList(true, html);
                            that.requestMore();
                        } else {
                            alert('数据请求失败,' + data.message);
                        }
                    });
                },
                setParams: function (params) {
                    var that = this;
                    that.limit = params['limit'];
                    that.offset = params['offset'];
                    that.s = params['s'];
                    that.shop_id = params['shop_id'];
                    that.type = params['type'];
                },
                getParams: function (key) {
                    if (this.hasOwnProperty(key)) {
                        return this[key];
                    } else {
                        return false;
                    }
                },
                appendList: function (flag, html) {
                    //true为重新加载
                    if (flag) {
                        $('#eval_list').empty().append(html);
                    } else {
                        $('#eval_list').append(html);
                    }
                },
                requestEval: function (callback) {
                    var that = this,
                            $this_click = $('#get_more');

                    $this_click.text('加载中');
                    $.ajax({
                        url: '/client/shop/shopComment/browse?offset=' + that.offset + '&shop_id=' + that['shop_id'] + '&type=0',
                        type: 'get',
                        dataType: 'json',
                        success: function (data) {
                            callback.call(this, data);
                            init_flag = 0;
                            if (data.data.list.length) {
                                $this_click.text('点击加载更多');
                            } else {
                                $this_click.text('没有查询到数据');
                            }
                        }
                    });
                },
                createHtml: function (list) {
                    var html = [],
                            len = list.length;
                    if (len) {
                        while (len--) {
                            html.push('<li><div class="evaluate-head"><img src="' + list[len]["user_logo_s"] + '" width="100%"></div>');
                            html.push('<div class="evaluate-content"><div class="evaluate-title"><span class="pull-left">' + list[len]["tname"] + '</span>');
                            html.push('<span class="pull-right text-right">' + list[len]["create_time"] + '</span></div><p>' + list[len]["comment_content"] + '</p></div></li>');
                        }
                    }
                    return html.join('');
                },
                requestMore: function () {
                    var that = this;
                    $('#get_more').on('tap', function () {
                        that.offset += 10;
                        that.requestEval(function (data) {
                            if (data.status == 0) {
                                that.setParams(data.data['request_param']);
                                var html = that.createHtml(data.data['list']);
                                that.appendList(false, html);
                            } else {
                                alert('数据请求失败,' + data.message);
                            }
                        });
                    });
                }
            };
            return eval.init();
        };
    });
</script>
</body>
</html>